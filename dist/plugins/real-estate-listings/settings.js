!function(){const e=function(e,t){console.log(`[REAL-ESTATE-SETTINGS] ${e}`,t||"")};e("Settings script initializing"),e("Defining settings schema");const t=[{type:"custom",id:"setup-wizard-container",render:function(){const t=document.querySelector(".dashboard-wrapper, body"),r=t&&"false"===t.getAttribute("data-wizard-enabled"),a="true"===localStorage.getItem("disable_wizard");return r||a||!function(t){try{return window.Dashboard&&window.Dashboard.WizardSystem&&"function"==typeof window.Dashboard.WizardSystem.isWizardRequired?window.Dashboard.WizardSystem.isWizardRequired(t):"true"!==localStorage.getItem(`${t}_completed`)}catch(t){return e("Error checking wizard status, assuming not required",t),!1}}("real-estate-setup-wizard")?"":'<div id="real-estate-wizard-container"></div>'},bindEvents:function(t){const r=t.querySelector("#real-estate-wizard-container");r&&function(t){try{if(window.Dashboard&&window.Dashboard.WizardSystem&&"function"==typeof window.Dashboard.WizardSystem.loadWizard)e("Loading wizard using Dashboard.WizardSystem"),window.Dashboard.WizardSystem.loadWizard("real-estate-listings",t);else{e("Wizard system not found, using fallback script loading");const r=document.createElement("script");r.src="plugins/real-estate-listings/wizard.js",r.onload=()=>{e("Wizard script loaded"),window.RealEstateWizard&&"function"==typeof window.RealEstateWizard.init?window.RealEstateWizard.init(t):t.innerHTML="<p>Wizard could not be initialized.</p>"},r.onerror=()=>{e("Error loading wizard script"),t.innerHTML="<p>Could not load the setup wizard.</p>"},document.head.appendChild(r)}}catch(r){e("Error initializing wizard",r),t.innerHTML="<p>Error initializing setup wizard.</p>"}}(r)}},{type:"category",id:"general",label:"General",isDefault:!0,components:[{type:"toggle",id:"enabled",label:"Enable Real Estate Listings Plugin",default:!0},{type:"text",id:"collection-slug",label:"Collection URL Path",default:"find-your-home",helpText:"The URL path of your Squarespace blog collection with property listings"},{type:"text",id:"listing-title",label:"Listings Section Title",width:"half",default:"Properties",placeholder:"Enter title for your listings section",helpText:"This will appear as the main heading for your listings section"},{type:"dropdown",id:"layout",label:"Default Layout",width:"half",options:[{value:"grid",label:"Grid View"},{value:"list",label:"List View"},{value:"map",label:"Map View"}],default:"grid",helpText:"The default view your visitors will see"},{type:"slider",id:"items-per-page",label:"Items Per Page",width:"half",min:3,max:24,step:3,default:9,helpText:"Number of properties to display per page"},{type:"dropdown",id:"grid-columns",label:"Grid Columns",width:"half",options:[{value:"2",label:"2 Columns"},{value:"3",label:"3 Columns"},{value:"4",label:"4 Columns"}],default:"3",helpText:"Number of columns"},{type:"color",id:"price-color",label:"Price Text Color",width:"half",default:"slot5"},{type:"color",id:"status-bg-color",label:"Status Badge Background",width:"half",default:"slot1"}]},{type:"category",id:"properties",label:"Manage Properties",components:[{type:"custom",id:"property-manager",label:"Manage Properties",render:function(){return'<div id="property-manager-container" class="property-manager-wrapper">\n                                    <div class="loading-indicator">Loading property manager...</div>\n                                </div>'},bindEvents:function(t){const r=t.querySelector("#property-manager-container");if(r){e("Initializing property manager container"),window._propertyManagerLoading={attemptCount:0,maxAttempts:2,loaded:!1,errors:[]};const t=(a,i=!1)=>{e(`${i?"FALLBACK: ":""}Trying to load from: ${a}`),window._propertyManagerLoading.attemptCount++,fetch(a).then((t=>{if(e(`${i?"FALLBACK: ":""}Fetch response status: ${t.status}`),!t.ok)throw new Error(`Failed to load property manager. Status: ${t.status}`);return t.text()})).then((o=>{try{e(`${i?"FALLBACK: ":""}Script content received, length: ${o.length}`);const t=o.match(/import\s+.*?from\s+['"].*?['"]/g)||[];t.length>0&&(e(`${i?"FALLBACK: ":""}Found import statements that may cause issues: ${JSON.stringify(t)}`),o=o.replace(/import\s+.*?from\s+['"].*?['"]/g,"// Import removed")),e((i?"FALLBACK: ":"")+"Executing script content");if(new Function(o)(),e((i?"FALLBACK: ":"")+"Script execution complete"),!window.PropertyManager||"function"!=typeof window.PropertyManager.initialize)throw e((i?"FALLBACK: ":"")+"PropertyManager object not found or initialize method not available"),new Error("PropertyManager object not found after script execution");e((i?"FALLBACK: ":"")+"PropertyManager object found, initializing"),window._propertyManagerLoading.loaded=!0,window.PropertyManager.initialize(r.id)}catch(o){e(`${i?"FALLBACK: ":""}Error executing property manager script: ${o.message}`),console.error(o),window._propertyManagerLoading.errors.push({url:a,error:o.message,isLocalFallback:i}),!i&&window._propertyManagerLoading.attemptCount<window._propertyManagerLoading.maxAttempts?(e("CDN load failed, trying local file as fallback"),t("plugins/real-estate-listings/property-manager.js",!0)):r.innerHTML=`<div class="error-message">Error loading property manager: ${o.message}</div>`}})).catch((o=>{e(`${i?"FALLBACK: ":""}Fetch error: ${o.message}`),window._propertyManagerLoading.errors.push({url:a,error:o.message,isLocalFallback:i}),!i&&window._propertyManagerLoading.attemptCount<window._propertyManagerLoading.maxAttempts?(e("CDN load failed, trying local file as fallback"),t("plugins/real-estate-listings/property-manager.js",!0)):r.innerHTML=`<div class="error-message">Error loading property manager: ${o.message}</div>`}))};e("Starting with local version for reliability"),t("plugins/real-estate-listings/property-manager.js",!0)}else e("Container element #property-manager-container not found")}}]},{type:"category",id:"filtering",label:"Filtering",components:[{type:"toggle",id:"show-filters",label:"Enable Filtering",default:!0,helpText:"Allow visitors to filter properties by price, bedrooms, etc."},{type:"checkbox-group",id:"visible-filters",label:"Filter options",options:[{value:"price",label:"Price"},{value:"bedrooms",label:"Bedrooms"},{value:"bathrooms",label:"Bathrooms"},{value:"area",label:"Area (sq ft/m²)"},{value:"status",label:"Property Status"}],default:["price","bedrooms","bathrooms","area","status"],helpText:"Select which filter options to display in the property filter"},{type:"text",id:"categories-label",label:"Categories label",width:"half",default:"Location",helpText:"The label above the categories dropdown in the filter"},{type:"text",id:"tags-label",label:"Tags label",width:"half",default:"Status",helpText:"The label above the tags dropdown in the filter"}]},{type:"category",id:"fields",label:"Fields & Data",components:[{type:"checkbox-group",id:"visible-fields",label:"Property Information to Display",options:[{value:"price",label:"Price"},{value:"bedrooms",label:"Bedrooms"},{value:"bathrooms",label:"Bathrooms"},{value:"area",label:"Area (sq ft/m²)"},{value:"garage",label:"Garage Spaces"},{value:"year",label:"Year Built"},{value:"status",label:"Property Status"}],default:["price","bedrooms","bathrooms","area","status"],helpText:"Select which property details to display in the listing"},{type:"text",id:"currency-symbol",label:"Currency Symbol",width:"half",default:"$",helpText:"Symbol to display before prices"},{type:"dropdown",id:"area-unit",label:"Area Unit",width:"half",options:[{value:"sqft",label:"Square Feet"},{value:"sqm",label:"Square Meters"}],default:"sqft",helpText:"Unit to use for property area"}]}];try{e("Attempting to register settings schema"),void 0!==window.PluginRegistry?(e("PluginRegistry found, registering schema"),window.PluginRegistry.registerSettingsSchema("real-estate-listings",t,{onChange:(t,r)=>{e(`Setting changed: ${t} = ${r}`),"collection-slug"===t&&r&&window.PropertyManager&&window.PropertyManager.propertyDataManager&&window.PropertyManager.propertyDataManager.forceReload()},onSave:t=>{e("Settings saved"),e("Applying real estate listings settings"),window.PropertyManager&&window.PropertyManager.propertyDataManager&&window.PropertyManager.propertyDataManager.propertyDetails&&window.PluginRegistry&&window.PluginRegistry.registerPluginData("real-estate-listings","property-manager",window.PropertyManager.propertyDataManager.propertyDetails);const r=window.PluginRegistry.getPluginData("real-estate-listings","settings");r&&"function"==typeof r.onSaveHandler&&r.onSaveHandler(t)}}),e("Settings schema registered successfully"),"function"==typeof window.PluginRegistry.notifySettingsLoaded&&(e("Notifying dashboard that settings are loaded"),window.PluginRegistry.notifySettingsLoaded("real-estate-listings"))):(e("PluginRegistry not found - registration failed"),console.error("PluginRegistry not found - Real Estate Listings settings schema could not be registered"))}catch(t){e("Error during settings registration",t),console.error("Error registering Real Estate Listings settings:",t)}if(window.PluginRegistry&&window.PluginRegistry._scriptLoadCallbacks){const t=window.PluginRegistry._scriptLoadCallbacks["real-estate-listings"];Array.isArray(t)&&(e("Executing script load callbacks directly"),t.forEach((e=>{try{"function"==typeof e&&e()}catch(e){console.error("Error in script load callback:",e)}})))}window.realEstateDebug={checkRegistration:function(){if(!window.PluginRegistry)return{status:"error",message:"PluginRegistry not available"};const e=window.PluginRegistry.getSettingsSchema("real-estate-listings"),t=Boolean(e);return{status:t?"success":"error",isRegistered:t,schemaLength:t?e.length:0,pluginRegistry:Boolean(window.PluginRegistry),propertyManager:Boolean(window.PropertyManager)}},registerNow:function(){try{return window.PluginRegistry?(window.PluginRegistry.registerSettingsSchema("real-estate-listings",t),window.PluginRegistry.notifySettingsLoaded("real-estate-listings"),{status:"success",message:"Schema re-registered"}):{status:"error",message:"PluginRegistry not available"}}catch(e){return{status:"error",message:e.message,error:e}}},reloadPropertyManager:function(){const e=document.getElementById("property-manager-container");return e?(e.innerHTML='<div class="loading-indicator">Reloading property manager...</div>',loadPropertyManager("plugins/real-estate-listings/property-manager.js",!0),{status:"success",message:"Reloading property manager"}):{status:"error",message:"Property manager container not found"}}},e("Settings script initialization complete"),window.realEstateListingsSettings=t}();